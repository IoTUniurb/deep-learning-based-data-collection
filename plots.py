import os
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import io

PLOTS_DIR = "/home/l.calisti/notebooks/dlds_paper/plots"

# create plots dir
os.makedirs(PLOTS_DIR, exist_ok=True)


def plot(
    xs: list,
    ys: list,
    save_path: str,
    labels: list[str] = None,
    xlabel: str = None,
    ylabel: str = None,
    label_size: int = 18,
    tick_size: int = 16,
    fmts: list[str] = None,
    grid: bool = False,
    figsize: tuple[float] = (8, 4.5),
    xlim: tuple = None,
    ylim: tuple = None,
    colors: list = None,
    line_width: list[float] = None,
    legend_pos: str = "best",
    marker_size: list[float] = None,
    marker_line_width: list[float] = None,
    filled: bool = True,
):
    assert len(xs) == len(
        ys
    ), f"xs and ys must have the same size. {len(xs)} != {len(ys)}"
    # assert len(xs) <= 5, f"not enough colors for {len(xs)} lines"

    default_colors = [
        (0.00, 0.45, 0.74),
        (0.85, 0.33, 0.10),
        (0.93, 0.69, 0.13),
        (0.49, 0.18, 0.56),
        (0.47, 0.67, 0.19),
    ]
    if colors is None:
        colors = default_colors

    fig, ax = plt.subplots(figsize=figsize)

    for i in range(len(xs)):
        label = None
        if labels is not None:
            label = labels[i]
        fmt = "-o"
        if fmts is not None:
            fmt = fmts[i]
        lw = 2
        if line_width is not None:
            lw = line_width[i]
        ms = 6
        if marker_size is not None:
            ms = marker_size[i]

        mfc = colors[i] if filled else "none"

        ax.plot(
            xs[i],
            ys[i],
            fmt,
            label=label,
            color=colors[i],
            linewidth=lw,
            mfc=mfc,
            mec=colors[i],
            ms=ms,
            mew=1.5,
        )

    ax.tick_params(axis="both", which="major", labelsize=tick_size)
    if xlabel is not None:
        ax.set_xlabel(xlabel, fontdict={"size": label_size})
    if ylabel is not None:
        ax.set_ylabel(ylabel, fontdict={"size": label_size})

    if xlim is not None:
        ax.set_xlim(xlim)
    if ylim is not None:
        ax.set_ylim(ylim)

    if grid:
        ax.grid(color=(0.15, 0.15, 0.15), alpha=0.15)
        ax.minorticks_on()
        ax.grid(
            True,
            which="minor",
            linestyle="--",
            linewidth=0.5,
            color=(0.15, 0.15, 0.15),
            alpha=0.15,
        )
    if labels is not None:
        leg = ax.legend(fontsize=12, loc=legend_pos)
        leg.get_frame().set_edgecolor("black")
        leg.get_frame().set_linewidth(0.8)
        leg.get_frame().set_linestyle("-")
        leg.get_frame().set_boxstyle("Square")

    fig.tight_layout()
    plt.savefig(save_path)


def from_string(data: str, sep: str = "\t", header: int = None):
    return pd.read_csv(io.StringIO(data), sep=sep, header=header)


# ## DLBDC simulation

data = from_string(
    """
dataset	seed	model	window size	time steps	error	realign	alpha	tot samples	sensing count	inferences count	send count	skip count	error acc	error percent acc	Transmission Rate	Suppression Rate	Inference Rate	Sensing Rate	MAE	MAPE
co2_peano_no_weekend	69	model3	5	1	1	scaled-distance	0.5	5000	5000	4995	2324	2676	7600.379028	13.32849926	0.4648	0.5352	0.999	1	2.840201431	0.004980755
co2_peano_no_weekend	69	model3	5	1	3	scaled-distance	0.5	5000	5000	4995	884	4116	34195.04971	56.9547958	0.1768	0.8232	0.999	1	8.307835207	0.013837414
co2_peano_no_weekend	69	model3	5	1	5	scaled-distance	0.5	5000	5000	4995	545	4455	55387.40509	92.0481779	0.109	0.891	0.999	1	12.43263863	0.020661768
co2_peano_no_weekend	69	model3	5	1	7	scaled-distance	0.5	5000	5000	4995	425	4575	76003.00568	125.3711264	0.085	0.915	0.999	1	16.61267884	0.027403525
co2_peano_no_weekend	69	model3	5	1	10	scaled-distance	0.5	5000	5000	4995	297	4703	109022.1097	178.0843062	0.0594	0.9406	0.999	1	23.18139693	0.037866108
co2_peano_no_weekend	69	model3	5	1	25	scaled-distance	0.5	5000	5000	4995	105	4895	269170.8952	419.4926738	0.021	0.979	0.999	1	54.98894692	0.085698197
co2_peano_no_weekend	69	DBP	20	1	1	simple-append	1	5000	5000	4980	2322	2678	7290.714464	12.85091742	0.4644	0.5356	0.996	1	2.722447522	0.0047987
co2_peano_no_weekend	69	DBP	20	1	3	simple-append	1	5000	5000	4980	1066	3934	34338.66795	58.05610412	0.2132	0.7868	0.996	1	8.728690379	0.014757525
co2_peano_no_weekend	69	DBP	20	1	5	simple-append	1	5000	5000	4980	694	4306	67026.32274	111.2953144	0.1388	0.8612	0.996	1	15.5657972	0.025846566
co2_peano_no_weekend	69	DBP	20	1	7	simple-append	1	5000	5000	4980	487	4513	99905.05736	165.342842	0.0974	0.9026	0.996	1	22.13717203	0.036637014
co2_peano_no_weekend	69	DBP	20	1	10	simple-append	1	5000	5000	4980	320	4680	153051.7039	256.7759672	0.064	0.936	0.996	1	32.70335554	0.05486666
co2_peano_no_weekend	69	DBP	20	1	25	simple-append	1	5000	5000	4980	93	4907	356928.1248	594.1773332	0.0186	0.9814	0.996	1	72.73856223	0.121087698
co2_peano_no_weekend	69	KF	3	1	1	simple-append	1	5000	5000	4997	4427	573	1635.272549	3.124879365	0.8854	0.1146	0.9994	1	2.853878794	0.005453542
co2_peano_no_weekend	69	KF	3	1	3	simple-append	1	5000	5000	4997	3682	1318	12662.7508	23.98148553	0.7364	0.2636	0.9994	1	9.607549922	0.018195361
co2_peano_no_weekend	69	KF	3	1	5	simple-append	1	5000	5000	4997	3096	1904	33649.3037	62.40315532	0.6192	0.3808	0.9994	1	17.67295362	0.032774766
co2_peano_no_weekend	69	KF	3	1	7	simple-append	1	5000	5000	4997	2609	2391	62003.68997	113.0668147	0.5218	0.4782	0.9994	1	25.93211626	0.047288505
co2_peano_no_weekend	69	KF	3	1	10	simple-append	1	5000	5000	4997	2021	2979	115007.7575	206.4693899	0.4042	0.5958	0.9994	1	38.6061623	0.069308288
co2_peano_no_weekend	69	KF	3	1	25	simple-append	1	5000	5000	4997	439	4561	444141.4906	764.1709022	0.0878	0.9122	0.9994	1	97.37809485	0.167544596
noise_peano_no_weekend	69	model3	5	1	1	scaled-distance	1	5000	5000	4995	2530	2470	21.83578673	11.7604165	0.506	0.494	0.999	1	0.008840399	0.004761302
noise_peano_no_weekend	69	model3	5	1	3	scaled-distance	1	5000	5000	4995	1267	3733	90.59600858	47.72721845	0.2534	0.7466	0.999	1	0.024268955	0.012785218
noise_peano_no_weekend	69	model3	5	1	5	scaled-distance	1	5000	5000	4995	838	4162	164.9755616	88.64667716	0.1676	0.8324	0.999	1	0.03963853	0.021299057
noise_peano_no_weekend	69	model3	5	1	7	scaled-distance	1	5000	5000	4995	591	4409	247.2933461	132.7318041	0.1182	0.8818	0.999	1	0.056088307	0.030104741
noise_peano_no_weekend	69	model3	5	1	10	scaled-distance	1	5000	5000	4995	401	4599	361.1309841	193.7794709	0.0802	0.9198	0.999	1	0.078523806	0.042135132
noise_peano_no_weekend	69	model3	5	1	25	scaled-distance	1	5000	5000	4995	138	4862	875.2635167	475.4659131	0.0276	0.9724	0.999	1	0.180021291	0.097792249
noise_peano_no_weekend	69	DBP	20	1	1	simple-append	1	5000	5000	4980	2905	2095	17.82484353	9.595542681	0.581	0.419	0.996	1	0.008508279	0.004580211
noise_peano_no_weekend	69	DBP	20	1	3	simple-append	1	5000	5000	4980	1439	3561	87.7124779	46.78305438	0.2878	0.7122	0.996	1	0.024631418	0.013137617
noise_peano_no_weekend	69	DBP	20	1	5	simple-append	1	5000	5000	4980	992	4008	156.0242153	84.52640689	0.1984	0.8016	0.996	1	0.038928197	0.021089423
noise_peano_no_weekend	69	DBP	20	1	7	simple-append	1	5000	5000	4980	743	4257	224.67619	120.8250162	0.1486	0.8514	0.996	1	0.052778057	0.028382668
noise_peano_no_weekend	69	DBP	20	1	10	simple-append	1	5000	5000	4980	542	4458	327.955986	179.3621551	0.1084	0.8916	0.996	1	0.073565721	0.040233772
noise_peano_no_weekend	69	DBP	20	1	25	simple-append	1	5000	5000	4980	159	4841	767.9972802	417.2527373	0.0318	0.9682	0.996	1	0.158644346	0.086191435
noise_peano_no_weekend	69	KF	3	1	1	simple-append	1	5000	5000	4997	3694	1306	11.50727352	6.101048945	0.7388	0.2612	0.9994	1	0.008811082	0.004671554
noise_peano_no_weekend	69	KF	3	1	3	simple-append	1	5000	5000	4997	2388	2612	71.63103395	37.66187305	0.4776	0.5224	0.9994	1	0.027423826	0.014418788
noise_peano_no_weekend	69	KF	3	1	5	simple-append	1	5000	5000	4997	1847	3153	148.0954325	78.73274317	0.3694	0.6306	0.9994	1	0.04696969	0.02497074
noise_peano_no_weekend	69	KF	3	1	7	simple-append	1	5000	5000	4997	1491	3509	241.1992356	129.7930434	0.2982	0.7018	0.9994	1	0.068737314	0.036988613
noise_peano_no_weekend	69	KF	3	1	10	simple-append	1	5000	5000	4997	1094	3906	410.4725868	221.8265858	0.2188	0.7812	0.9994	1	0.105087708	0.056791241
noise_peano_no_weekend	69	KF	3	1	25	simple-append	1	5000	5000	4997	259	4741	1137.969094	645.8104251	0.0518	0.9482	0.9994	1	0.240027229	0.136218187
pm2p5_peano_no_weekend	69	model3	5	1	1	scaled-distance	1	5000	5000	4995	3900	1100	24.31994254	5.301444134	0.78	0.22	0.999	1	0.022109039	0.004819495
pm2p5_peano_no_weekend	69	model3	5	1	3	scaled-distance	1	5000	5000	4995	2366	2634	152.5690313	37.24725771	0.4732	0.5268	0.999	1	0.057922943	0.014140948
pm2p5_peano_no_weekend	69	model3	5	1	5	scaled-distance	1	5000	5000	4995	1538	3462	312.1118373	77.485087	0.3076	0.6924	0.999	1	0.090153621	0.022381596
pm2p5_peano_no_weekend	69	model3	5	1	7	scaled-distance	1	5000	5000	4995	1189	3811	458.7374149	117.8327512	0.2378	0.7622	0.999	1	0.120371927	0.030919116
pm2p5_peano_no_weekend	69	model3	5	1	10	scaled-distance	1	5000	5000	4995	838	4162	723.3275869	180.8477218	0.1676	0.8324	0.999	1	0.173793269	0.04345212
pm2p5_peano_no_weekend	69	model3	5	1	25	scaled-distance	1	5000	5000	4995	312	4688	2027.816716	501.0133741	0.0624	0.9376	0.999	1	0.43255476	0.106871454
pm2p5_peano_no_weekend	69	DBP	20	1	1	simple-append	1	5000	5000	4980	4265	735	16.37196484	3.714862313	0.853	0.147	0.996	1	0.022274782	0.005054234
pm2p5_peano_no_weekend	69	DBP	20	1	3	simple-append	1	5000	5000	4980	2935	2065	130.4340839	30.41267894	0.587	0.413	0.996	1	0.063164205	0.01472769
pm2p5_peano_no_weekend	69	DBP	20	1	5	simple-append	1	5000	5000	4980	2015	2985	285.8981862	70.20456606	0.403	0.597	0.996	1	0.095778287	0.023519118
pm2p5_peano_no_weekend	69	DBP	20	1	7	simple-append	1	5000	5000	4980	1461	3539	477.6555068	114.4903644	0.2922	0.7078	0.996	1	0.134969061	0.03235105
pm2p5_peano_no_weekend	69	DBP	20	1	10	simple-append	1	5000	5000	4980	991	4009	731.2006043	179.6182338	0.1982	0.8018	0.996	1	0.182389774	0.04480375
pm2p5_peano_no_weekend	69	DBP	20	1	25	simple-append	1	5000	5000	4980	310	4690	1978.54716	485.4987784	0.062	0.938	0.996	1	0.421865066	0.103517863
pm2p5_peano_no_weekend	69	KF	3	1	1	simple-append	1	5000	5000	4997	4699	301	5.564189527	1.494714983	0.9398	0.0602	0.9994	1	0.018485679	0.004965831
pm2p5_peano_no_weekend	69	KF	3	1	3	simple-append	1	5000	5000	4997	4170	830	47.34984401	12.27066039	0.834	0.166	0.9994	1	0.057048005	0.014783928
pm2p5_peano_no_weekend	69	KF	3	1	5	simple-append	1	5000	5000	4997	3695	1305	126.2839836	32.2383494	0.739	0.261	0.9994	1	0.096769336	0.024703716
pm2p5_peano_no_weekend	69	KF	3	1	7	simple-append	1	5000	5000	4997	3306	1694	233.231347	58.85679879	0.6612	0.3388	0.9994	1	0.137680842	0.034744273
pm2p5_peano_no_weekend	69	KF	3	1	10	simple-append	1	5000	5000	4997	2767	2233	465.9015397	115.3981135	0.5534	0.4466	0.9994	1	0.208643771	0.05167851
pm2p5_peano_no_weekend	69	KF	3	1	25	simple-append	1	5000	5000	4997	1303	3697	1913.442953	480.2376043	0.2606	0.7394	0.9994	1	0.517566392	0.129899271
rad_peano_no_weekend	69	model3	5	1	1	scaled-distance	1	5000	5000	4995	4407	593	706.207517	3.060006905	0.8814	0.1186	0.999	1	1.190906437	0.005160214
rad_peano_no_weekend	69	model3	5	1	3	scaled-distance	1	5000	5000	4995	3355	1645	6336.251872	23.99546967	0.671	0.329	0.999	1	3.851824846	0.014586912
rad_peano_no_weekend	69	model3	5	1	5	scaled-distance	1	5000	5000	4995	2506	2494	15814.87602	61.35305389	0.5012	0.4988	0.999	1	6.341169214	0.024600262
rad_peano_no_weekend	69	model3	5	1	7	scaled-distance	1	5000	5000	4995	1995	3005	25361.11783	99.72931142	0.399	0.601	0.999	1	8.439639875	0.033187791
rad_peano_no_weekend	69	model3	5	1	10	scaled-distance	1	5000	5000	4995	1523	3477	39577.41684	161.3231843	0.3046	0.6954	0.999	1	11.38263355	0.046397234
rad_peano_no_weekend	69	model3	5	1	25	scaled-distance	1	5000	5000	4995	738	4262	121609.9715	510.572323	0.1476	0.8524	0.999	1	28.53354565	0.119796416
rad_peano_no_weekend	69	DBP	20	1	1	simple-append	1	5000	5000	4980	4248	752	890.4560451	3.753265383	0.8496	0.1504	0.996	1	1.184117081	0.004991044
rad_peano_no_weekend	69	DBP	20	1	3	simple-append	1	5000	5000	4980	3006	1994	6366.154082	28.41272133	0.6012	0.3988	0.996	1	3.192655006	0.014249108
rad_peano_no_weekend	69	DBP	20	1	5	simple-append	1	5000	5000	4980	2055	2945	15079.91218	68.47254403	0.411	0.589	0.996	1	5.120513474	0.023250439
rad_peano_no_weekend	69	DBP	20	1	7	simple-append	1	5000	5000	4980	1456	3544	25295.80227	110.3619272	0.2912	0.7088	0.996	1	7.137641725	0.031140499
rad_peano_no_weekend	69	DBP	20	1	10	simple-append	1	5000	5000	4980	846	4154	42593.20613	176.5284969	0.1692	0.8308	0.996	1	10.25354023	0.042496027
rad_peano_no_weekend	69	DBP	20	1	25	simple-append	1	5000	5000	4980	302	4698	104703.8299	381.075865	0.0604	0.9396	0.996	1	22.2868944	0.081114488
rad_peano_no_weekend	69	KF	3	1	1	simple-append	1	5000	5000	4997	4474	526	449.6650166	2.572730874	0.8948	0.1052	0.9994	1	0.854876457	0.004891123
rad_peano_no_weekend	69	KF	3	1	3	simple-append	1	5000	5000	4997	3429	1571	3873.042207	23.51490707	0.6858	0.3142	0.9994	1	2.465335587	0.014968114
rad_peano_no_weekend	69	KF	3	1	5	simple-append	1	5000	5000	4997	2548	2452	9883.967766	59.07314836	0.5096	0.4904	0.9994	1	4.03098196	0.024091822
rad_peano_no_weekend	69	KF	3	1	7	simple-append	1	5000	5000	4997	1934	3066	17235.10516	98.9061475	0.3868	0.6132	0.9994	1	5.621365022	0.032259017
rad_peano_no_weekend	69	KF	3	1	10	simple-append	1	5000	5000	4997	1359	3641	29221.96448	158.9022093	0.2718	0.7282	0.9994	1	8.025807328	0.043642463
rad_peano_no_weekend	69	KF	3	1	25	simple-append	1	5000	5000	4997	615	4385	107624.6171	455.1719246	0.123	0.877	0.9994	1	24.54381234	0.103802035
    """,
    header=0,
)
data["error"] *= 0.01

# ### SR vs. error

# +
d = data[["dataset", "model", "error", "Suppression Rate"]]
d = d.drop(d[d["error"] == 0.25].index)
d = np.array(np.split(d.values, 4))

co2 = np.array(np.split(d[0], 3))
noise = np.array(np.split(d[1], 3))
pm = np.array(np.split(d[2], 3))
rad = np.array(np.split(d[3], 3))

os.makedirs(os.path.join(PLOTS_DIR, "dlbdc_SR_error"), exist_ok=True)

plot(
    xs=co2[:, :, 2],
    ys=co2[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlbdc_SR_error", "co2_SR_error_dlbdc.pdf"),
    labels=["DLBDC", "DBP", "KF"],
    xlabel="$\delta$",
    ylabel="$SR$",
    grid=True,
    ylim=(0, 1),
    label_size=22,
    tick_size=20,
)
plot(
    xs=noise[:, :, 2],
    ys=noise[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlbdc_SR_error", "noise_SR_error_dlbdc.pdf"),
    labels=["DLBDC", "DBP", "KF"],
    xlabel="$\delta$",
    ylabel="$SR$",
    grid=True,
    ylim=(0, 1),
    label_size=22,
    tick_size=20,
)
plot(
    xs=pm[:, :, 2],
    ys=pm[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlbdc_SR_error", "pm_SR_error_dlbdc.pdf"),
    labels=["DLBDC", "DBP", "KF"],
    xlabel="$\delta$",
    ylabel="$SR$",
    grid=True,
    ylim=(0, 1),
    label_size=22,
    tick_size=20,
)
plot(
    xs=rad[:, :, 2],
    ys=rad[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlbdc_SR_error", "rad_SR_error_dlbdc.pdf"),
    labels=["DLBDC", "DBP", "KF"],
    xlabel="$\delta$",
    ylabel="$SR$",
    grid=True,
    ylim=(0, 1),
    label_size=22,
    tick_size=20,
)
# -

# ### MAPE vs. error

# +
d = data[["dataset", "model", "error", "MAPE"]]
d = d.drop(d[d["error"] == 0.25].index)
d = np.array(np.split(d.values, 4))

co2 = np.array(np.split(d[0], 3))
noise = np.array(np.split(d[1], 3))
pm = np.array(np.split(d[2], 3))
rad = np.array(np.split(d[3], 3))

os.makedirs(os.path.join(PLOTS_DIR, "dlbdc_MAPE_error"), exist_ok=True)

plot(
    xs=co2[:, :, 2],
    ys=co2[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlbdc_MAPE_error", "co2_MAPE_error_dlbdc.pdf"),
    labels=["DLBDC", "DBP", "KF"],
    xlabel="$\delta$",
    ylabel="$MAPE$",
    grid=True,
    ylim=(0, 0.10),
    label_size=22,
    tick_size=20,
)
plot(
    xs=noise[:, :, 2],
    ys=noise[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlbdc_MAPE_error", "noise_MAPE_error_dlbdc.pdf"),
    labels=["DLBDC", "DBP", "KF"],
    xlabel="$\delta$",
    ylabel="$MAPE$",
    grid=True,
    ylim=(0, 0.10),
    label_size=22,
    tick_size=20,
)
plot(
    xs=pm[:, :, 2],
    ys=pm[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlbdc_MAPE_error", "pm_MAPE_error_dlbdc.pdf"),
    labels=["DLBDC", "DBP", "KF"],
    xlabel="$\delta$",
    ylabel="$MAPE$",
    grid=True,
    ylim=(0, 0.10),
    label_size=22,
    tick_size=20,
)
plot(
    xs=rad[:, :, 2],
    ys=rad[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlbdc_MAPE_error", "rad_MAPE_error_dlbdc.pdf"),
    labels=["DLBDC", "DBP", "KF"],
    xlabel="$\delta$",
    ylabel="$MAPE$",
    grid=True,
    ylim=(0, 0.10),
    label_size=22,
    tick_size=20,
)
# -

# ## DLDS validation

# +
data = from_string("""
dataset	model	seed	window size	time steps	MAE	MAPE
co2_peano_no_weekend	model3	69	5	3	7.488694719	0.011701187
co2_peano_no_weekend	model3	69	5	5	11.82515132	0.018247978
co2_peano_no_weekend	model3	69	5	7	15.79481758	0.024669093
co2_peano_no_weekend	model3	69	5	10	19.82374899	0.030417724
pm2p5_peano_no_weekend	model3	69	5	3	0.197025061	0.054187101
pm2p5_peano_no_weekend	model3	69	5	5	0.268949285	0.072840083
pm2p5_peano_no_weekend	model3	69	5	7	0.317278555	0.083817125
pm2p5_peano_no_weekend	model3	69	5	10	0.388799573	0.102119745
rad_peano_no_weekend	model3	69	5	3	29.03514538	0.080119638
rad_peano_no_weekend	model3	69	5	5	48.61041227	0.155931907
rad_peano_no_weekend	model3	69	5	7	55.08638906	0.164620968
rad_peano_no_weekend	model3	69	5	10	64.902418	0.187560136
noise_peano_no_weekend	model3	69	5	3	0.061058225	0.031290154
noise_peano_no_weekend	model3	69	5	5	0.083607226	0.043713724
noise_peano_no_weekend	model3	69	5	7	0.096520566	0.049006108
noise_peano_no_weekend	model3	69	5	10	0.106266731	0.056193579
""",header=0)

d = data[["dataset", "time steps", "MAPE"]]
d = np.array(np.split(d.values, 4))
os.makedirs(os.path.join(PLOTS_DIR, "dlds_validate"), exist_ok=True)

plot(
    xs=d[:, :, 1],
    ys=d[:, :, 2],
    save_path=os.path.join(PLOTS_DIR, "dlds_validate", "co2_MAPE_ts_dlds.pdf"),
    labels=[
        "$CO_2$",
        "$PM_{2.5}$",
        "$\gamma~dose~rate$",
        "$Noise$",
    ],
    xlabel="$ts$",
    ylabel="$MAPE$",
    grid=True,
#     label_size=22,
#     tick_size=20,
    ylim=(0, 0.25),
#     legend_pos="lower right",
)

# +
data = from_string(
    """
dataset	model	seed	window size	time steps	MAE	MAPE	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15
co2_peano_no_weekend	model3	69	5	15	25.61951554	0.038912107	0.00910236	0.01318424	0.019069551	0.024936261	0.029670054	0.033986302	0.037782933	0.041459578	0.044761125	0.047612771	0.050468146	0.053493745	0.056355761	0.05936283	0.062435952
pm2p5_peano_no_weekend	model3	69	5	15	0.482061754	0.130774333	0.039644512	0.056181775	0.075165401	0.096303228	0.10689129	0.117717384	0.128528295	0.138408405	0.148238043	0.157327259	0.16482621	0.172278217	0.17950518	0.186540991	0.194058808
rad_peano_no_weekend	model3	69	5	15	78.64995096	0.240187248	0.058254795	0.098324696	0.135818638	0.18497174	0.222479738	0.246393033	0.261308345	0.272071053	0.280635373	0.287517037	0.294643385	0.302850368	0.310865958	0.31863549	0.328039075
noise_peano_no_weekend	model3	69	5	15	0.121344511	0.064070986	0.023546614	0.035703676	0.048131987	0.05808547	0.062475353	0.065726203	0.068025175	0.070135958	0.071727132	0.073114994	0.074628035	0.07575174	0.07685962	0.077980689	0.079172146
    """,
    header=0,
)
data = data[
    ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"]
].values
xs = (
    np.array(
        [
            np.arange(10),
            np.arange(10),
            np.arange(10),
            np.arange(10),
        ]
    )
    + 1
)


def linear(x: list, m: float, q: float):
    return x * m + q


ys = [
    data[0],
    #     linear(xs[0], 0.0037, 0.009),
    data[1],
    #     linear(xs[0], 0.0106, 0.0462),
    data[2],
    #     linear(xs[0], 0.0174, 0.1009),
    data[3],
    #     linear(xs[0], 0.0033, 0.038),
]

plot(
    ys=ys,
    xs=xs,
    save_path=os.path.join(PLOTS_DIR, "validate_dlds.pdf"),
    labels=["$CO_2$", "$PM_{2.5}$", "$\gamma~dose~rate$", "$noise$"],
    xlabel="$Sample~position$",
    ylabel="$MAPE$",
    grid=True,
    label_size=16,
    tick_size=14,
)
# -

# ## DLDS simulation - lerp

data = from_string(
    """
dataset	seed	model	window size	time steps	error	realign	alpha	tot samples	sensing count	inferences count	send count	skip count	error acc	error percent acc	Transmission Rate	Suppression Rate	Inference Rate	Sensing Rate	MAE	MAPE	Active Energy [J]	Slepping energy [J]	Total Energy [J]	Active Energy Ration	Sleeping Energy Ratio	Total Energy Ratio
co2_peano_no_weekend	69	model3	5	3	1	lerp	1	5000	1669	1664	934	4063	26515.29773	41.51336584	0.1868	0.8132	0.3328	0.3338	6.526039313	0.010217417	1093.647816	43763.75943	44857.40725	3.540721893	0.991884531	1.054026563
co2_peano_no_weekend	69	model3	5	5	1	lerp	1	5000	1003	998	705	4290	51316.06241	79.28684128	0.141	0.859	0.1996	0.2006	11.96178611	0.018481781	703.7052312	43824.7398	44528.44503	5.502734092	0.990504364	1.061813381
co2_peano_no_weekend	69	model3	5	7	1	lerp	1	5000	718	713	563	4433	73314.58499	111.8129761	0.1126	0.8874	0.1426	0.1436	16.53836792	0.025222869	522.5943662	43851.72437	44374.31874	7.409767531	0.989894848	1.065501401
co2_peano_no_weekend	69	model3	5	10	1	lerp	1	5000	504	499	431	4564	105267.2128	157.9488911	0.0862	0.9138	0.0998	0.1008	23.0646829	0.034607557	378.3887313	43872.49933	44250.88806	10.23366302	0.989426102	1.068473444
co2_peano_no_weekend	69	model3	5	15	1	lerp	1	5000	337	332	283	4702	131726.4623	198.7403682	0.0566	0.9434	0.0664	0.0674	28.01498561	0.042267199	251.2916842	43889.62086	44140.91255	15.40959375	0.989040123	1.071135508
co2_peano_no_weekend	69	model3	5	3	3	lerp	1	5000	1669	1664	454	4543	44847.61124	72.58778318	0.0908	0.9092	0.3328	0.3338	9.871805247	0.01597794	938.2796206	43773.46063	44711.74025	4.12702427	0.991664707	1.057460491
co2_peano_no_weekend	69	model3	5	5	3	lerp	1	5000	1003	998	431	4564	65625.86398	104.3976394	0.0862	0.9138	0.1996	0.2006	14.37902366	0.022874154	615.0158862	43830.27757	44445.29345	6.296264622	0.990379218	1.063799901
co2_peano_no_weekend	69	model3	5	7	3	lerp	1	5000	718	713	362	4634	84876.29361	132.9311318	0.0724	0.9276	0.1426	0.1436	18.31598913	0.028686045	457.5339342	43855.78675	44313.32068	8.463422004	0.989803153	1.066968082
co2_peano_no_weekend	69	model3	5	10	3	lerp	1	5000	504	499	298	4697	116669.9934	179.0917325	0.0596	0.9404	0.0998	0.1008	24.8392577	0.038128962	335.3387938	43875.18737	44210.52616	11.54743453	0.989365485	1.069448905
co2_peano_no_weekend	69	model3	5	15	3	lerp	1	5000	337	332	202	4783	134449.6521	206.5713482	0.0404	0.9596	0.0664	0.0674	28.10990008	0.043188657	225.0733012	43891.25794	44116.33124	17.20462954	0.989003233	1.071732337
co2_peano_no_weekend	69	model3	5	3	5	lerp	1	5000	1669	1664	290	4707	66741.32437	109.4131711	0.058	0.942	0.3328	0.3338	14.17916388	0.023244778	885.1954871	43776.7752	44661.97069	4.374517068	0.991589623	1.058638883
co2_peano_no_weekend	69	model3	5	5	5	lerp	1	5000	1003	998	307	4688	85768.83411	138.4088853	0.0614	0.9386	0.1996	0.2006	18.29539977	0.02952408	574.8791023	43832.78371	44407.66281	6.735855853	0.990322593	1.064701355
co2_peano_no_weekend	69	model3	5	7	5	lerp	1	5000	718	713	286	4710	103031.4501	165.0553727	0.0572	0.9428	0.1426	0.1436	21.87504248	0.035043604	432.9339699	43857.32277	44290.25674	8.944326469	0.989768487	1.067523701
co2_peano_no_weekend	69	model3	5	10	5	lerp	1	5000	504	499	215	4780	136943.9135	215.0563152	0.043	0.957	0.0998	0.1008	28.64935428	0.044990861	308.4730433	43876.86487	44185.33791	12.55313179	0.989327659	1.070058554
co2_peano_no_weekend	69	model3	5	15	5	lerp	1	5000	337	332	147	4838	149033.3601	233.3279413	0.0294	0.9706	0.0664	0.0674	30.80474578	0.048228181	207.2706954	43892.36953	44099.64023	18.68234561	0.988978186	1.072137971
co2_peano_no_weekend	69	model3	5	3	7	lerp	1	5000	1669	1664	213	4784	85019.68954	137.2736773	0.0426	0.9574	0.3328	0.3338	17.77167424	0.028694331	860.271839	43778.33144	44638.60328	4.501254825	0.991554374	1.05919306
co2_peano_no_weekend	69	model3	5	5	7	lerp	1	5000	1003	998	248	4747	105912.4318	173.999512	0.0496	0.9504	0.1996	0.2006	22.31144551	0.036654626	555.7817616	43833.97615	44389.75791	6.967308094	0.990295653	1.06513081
co2_peano_no_weekend	69	model3	5	7	7	lerp	1	5000	718	713	224	4772	125445.7799	203.5253065	0.0448	0.9552	0.1426	0.1436	26.28788347	0.042649897	412.865578	43858.57584	44271.44142	9.379088432	0.989740209	1.067977397
co2_peano_no_weekend	69	model3	5	10	7	lerp	1	5000	504	499	167	4828	156961.4128	249.5507216	0.0334	0.9666	0.0998	0.1008	32.51064887	0.051688219	292.9362237	43877.83499	44170.77121	13.21892772	0.989305786	1.070411439
co2_peano_no_weekend	69	model3	5	15	7	lerp	1	5000	337	332	117	4868	173149.0208	273.9222651	0.0234	0.9766	0.0664	0.0674	35.56882103	0.056269981	197.5601832	43892.97586	44090.53604	19.60062348	0.988964525	1.072359355
co2_peano_no_weekend	69	model3	5	3	10	lerp	1	5000	1669	1664	144	4853	114379.1393	184.81443	0.0288	0.9712	0.3328	0.3338	23.56874909	0.038082512	837.9376609	43779.72598	44617.66364	4.621230131	0.991522789	1.059690152
co2_peano_no_weekend	69	model3	5	5	10	lerp	1	5000	1003	998	183	4812	145890.4219	241.0310358	0.0366	0.9634	0.1996	0.2006	30.31804278	0.050089575	534.7423185	43835.28985	44370.03217	7.241436918	0.990265974	1.065604338
co2_peano_no_weekend	69	model3	5	7	10	lerp	1	5000	718	713	168	4828	157921.4254	259.3591338	0.0336	0.9664	0.1426	0.1436	32.70949159	0.053719787	394.7392885	43859.70765	44254.44694	9.809772878	0.989714668	1.068387519
co2_peano_no_weekend	69	model3	5	10	10	lerp	1	5000	504	499	122	4873	197257.5513	321.9862257	0.0244	0.9756	0.0998	0.1008	40.47969449	0.066075564	278.3704554	43878.74447	44157.11493	13.91060974	0.98928528	1.070742481
co2_peano_no_weekend	69	model3	5	15	10	lerp	1	5000	337	332	92	4893	199569.5506	312.5973685	0.0184	0.9816	0.0664	0.0674	40.78674649	0.063886648	189.4680897	43893.48113	44082.94922	20.43775695	0.988953141	1.072543911
co2_peano_no_weekend	69	model3	5	3	25	lerp	1	5000	1669	1664	51	4946	274223.5725	440.8148114	0.0102	0.9898	0.3328	0.3338	55.44350436	0.089125518	807.835073	43781.60559	44589.44066	4.793432343	0.991480222	1.060360885
co2_peano_no_weekend	69	model3	5	5	25	lerp	1	5000	1003	998	80	4915	328918.8967	549.5375847	0.016	0.984	0.1996	0.2006	66.92144389	0.111808257	501.4028931	43837.37157	44338.77446	7.722936623	0.990218949	1.066355562
co2_peano_no_weekend	69	model3	5	7	25	lerp	1	5000	718	713	75	4921	377422.5089	623.7670073	0.015	0.985	0.1426	0.1436	76.69630338	0.126756149	364.6367006	43861.58726	44226.22396	10.61961882	0.989672256	1.069069311
co2_peano_no_weekend	69	model3	5	10	25	lerp	1	5000	504	499	45	4950	356802.0731	565.1530083	0.009	0.991	0.0998	0.1008	72.08122688	0.114172325	253.4468073	43880.30071	44133.74752	15.27856203	0.989250195	1.071309405
co2_peano_no_weekend	69	model3	5	15	25	lerp	1	5000	337	332	42	4943	329024.7599	515.9655585	0.0084	0.9916	0.0664	0.0674	66.56377906	0.104383079	173.2839026	43894.49167	44067.77557	22.346581	0.988930373	1.072913215
pm2p5_peano_no_weekend	69	model3	5	3	1	lerp	1	5000	1669	1664	1471	3526	580.4893733	154.8736935	0.2942	0.7058	0.3328	0.3338	0.164631133	0.043923339	1267.465985	43752.90622	45020.3722	3.055153205	0.992130575	1.050211193
pm2p5_peano_no_weekend	69	model3	5	5	1	lerp	1	5000	1003	998	923	4072	1006.864827	280.3313349	0.1846	0.8154	0.1996	0.2006	0.247265429	0.068843648	774.2682867	43820.33384	44594.60213	5.001241602	0.990603955	1.060238157
pm2p5_peano_no_weekend	69	model3	5	7	1	lerp	1	5000	718	713	670	4326	1274.415932	340.9174965	0.134	0.866	0.1426	0.1436	0.294594529	0.078806633	557.2285264	43849.56181	44406.79034	6.949218467	0.989943667	1.064722274
pm2p5_peano_no_weekend	69	model3	5	10	1	lerp	1	5000	504	499	472	4523	1637.63185	441.1274384	0.0944	0.9056	0.0998	0.1008	0.362067621	0.097529834	391.6597647	43871.67069	44263.33045	9.886904696	0.989444791	1.068173097
pm2p5_peano_no_weekend	69	model3	5	15	1	lerp	1	5000	337	332	319	4666	2266.59127	620.8174654	0.0638	0.9362	0.0664	0.0674	0.485767525	0.133051321	262.9442989	43888.89327	44151.83757	14.72670365	0.989056519	1.070870464
pm2p5_peano_no_weekend	69	model3	5	3	3	lerp	1	5000	1669	1664	1124	3873	622.1162751	163.7265036	0.2248	0.7752	0.3328	0.3338	0.160629041	0.04227382	1155.147727	43759.91937	44915.0671	3.352214332	0.991971572	1.052673453
pm2p5_peano_no_weekend	69	model3	5	5	3	lerp	1	5000	1003	998	766	4229	1033.322938	286.212689	0.1532	0.8468	0.1996	0.2006	0.244342147	0.067678574	723.4499394	43823.50694	44546.95688	5.352551096	0.990532229	1.061372136
pm2p5_peano_no_weekend	69	model3	5	7	3	lerp	1	5000	718	713	562	4434	1289.824884	344.227756	0.1124	0.8876	0.1426	0.1436	0.2908942	0.077633684	522.2706824	43851.74458	44374.01527	7.414359827	0.989894391	1.065508688
pm2p5_peano_no_weekend	69	model3	5	10	3	lerp	1	5000	504	499	407	4588	1649.525887	443.5423382	0.0814	0.9186	0.0998	0.1008	0.35953049	0.096674442	370.6203215	43872.98439	44243.60471	10.44816634	0.989415163	1.068649336
pm2p5_peano_no_weekend	69	model3	5	15	3	lerp	1	5000	337	332	292	4693	2269.514819	621.2563923	0.0584	0.9416	0.0664	0.0674	0.483595742	0.132379372	254.2048379	43889.43896	44143.6438	15.23300185	0.989044222	1.071069235
pm2p5_peano_no_weekend	69	model3	5	3	5	lerp	1	5000	1669	1664	864	4133	708.7009966	184.0829074	0.1728	0.8272	0.3328	0.3338	0.171473747	0.044539779	1070.989954	43765.17419	44836.16414	3.6156294	0.991852468	1.054525954
pm2p5_peano_no_weekend	69	model3	5	5	5	lerp	1	5000	1003	998	620	4375	1080.986985	297.3350037	0.124	0.876	0.1996	0.2006	0.247082739	0.067962287	676.1921132	43826.45772	44502.64983	5.726631072	0.990465538	1.062428843
pm2p5_peano_no_weekend	69	model3	5	7	5	lerp	1	5000	718	713	467	4529	1341.988953	353.6008962	0.0934	0.9066	0.1426	0.1436	0.296310213	0.078074828	491.520727	43853.66461	44345.18534	7.878208493	0.989851051	1.066201402
pm2p5_peano_no_weekend	69	model3	5	10	5	lerp	1	5000	504	499	357	4638	1688.581599	452.6632604	0.0714	0.9286	0.0998	0.1008	0.364075377	0.097598806	354.4361345	43873.99493	44228.43107	10.92524827	0.989392374	1.069015962
pm2p5_peano_no_weekend	69	model3	5	15	5	lerp	1	5000	337	332	275	4710	2277.795884	620.2600853	0.055	0.945	0.0664	0.0674	0.483608468	0.131690039	248.7022143	43889.78255	44138.48476	15.57003735	0.989036479	1.071194424
pm2p5_peano_no_weekend	69	model3	5	3	7	lerp	1	5000	1669	1664	664	4333	815.3696164	209.9176309	0.1328	0.8672	0.3328	0.3338	0.188176694	0.048446257	1006.253206	43769.21635	44775.46956	3.848238935	0.991760868	1.055955398
pm2p5_peano_no_weekend	69	model3	5	5	7	lerp	1	5000	1003	998	480	4515	1170.766215	314.2842519	0.096	0.904	0.1996	0.2006	0.259305917	0.069608915	630.8763895	43829.28724	44460.16363	6.137973826	0.990401596	1.063444102
pm2p5_peano_no_weekend	69	model3	5	7	7	lerp	1	5000	718	713	388	4608	1376.535835	363.8715927	0.0776	0.9224	0.1426	0.1436	0.298727395	0.078965189	465.9497115	43855.26127	44321.21098	8.310559425	0.989815013	1.066778135
pm2p5_peano_no_weekend	69	model3	5	10	7	lerp	1	5000	504	499	317	4678	1704.541182	458.5613906	0.0634	0.9366	0.0998	0.1008	0.364373917	0.098025094	341.4887848	43874.80336	44216.29215	11.33947274	0.989374144	1.069309444
pm2p5_peano_no_weekend	69	model3	5	15	7	lerp	1	5000	337	332	249	4736	2304.440964	630.4416002	0.0498	0.9502	0.0664	0.0674	0.486579595	0.133116892	240.286437	43890.30803	44130.59447	16.11536138	0.989024638	1.071385948
pm2p5_peano_no_weekend	69	model3	5	3	10	lerp	1	5000	1669	1664	470	4527	996.5721148	255.0134379	0.094	0.906	0.3328	0.3338	0.220139632	0.056331663	943.4585605	43773.13725	44716.59581	4.10436974	0.991672033	1.057345666
pm2p5_peano_no_weekend	69	model3	5	5	10	lerp	1	5000	1003	998	376	4619	1262.055696	341.0639331	0.0752	0.9248	0.1996	0.2006	0.27323137	0.073839345	597.2132805	43831.38916	44428.60244	6.483952874	0.990354101	1.064199551
pm2p5_peano_no_weekend	69	model3	5	7	10	lerp	1	5000	718	713	298	4698	1530.494811	394.4709346	0.0596	0.9404	0.1426	0.1436	0.325775822	0.083965716	436.8181748	43857.08024	44293.89842	8.864793156	0.989773961	1.067435933
pm2p5_peano_no_weekend	69	model3	5	10	10	lerp	1	5000	504	499	265	4730	1824.348813	490.8069703	0.053	0.947	0.0998	0.1008	0.385697423	0.103764687	324.6572303	43875.85433	44200.51156	11.92735724	0.989350445	1.069691212
pm2p5_peano_no_weekend	69	model3	5	15	10	lerp	1	5000	337	332	219	4766	2338.400013	637.8298882	0.0438	0.9562	0.0664	0.0674	0.490642051	0.133829183	230.5759248	43890.91435	44121.49028	16.79404634	0.989010975	1.071607021
pm2p5_peano_no_weekend	69	model3	5	3	25	lerp	1	5000	1669	1664	165	4832	2051.07261	508.1720655	0.033	0.967	0.3328	0.3338	0.424476947	0.10516806	844.7350195	43779.30156	44624.03658	4.584044318	0.991532402	1.059538814
pm2p5_peano_no_weekend	69	model3	5	5	25	lerp	1	5000	1003	998	167	4828	2188.318786	576.8468644	0.0334	0.9666	0.1996	0.2006	0.453255755	0.119479467	529.5633786	43835.61323	44365.1766	7.312255573	0.990258669	1.065720964
pm2p5_peano_no_weekend	69	model3	5	7	25	lerp	1	5000	718	713	135	4861	2293.911627	604.1929206	0.027	0.973	0.1426	0.1436	0.471901178	0.124293956	384.0577251	43860.37461	44244.43233	10.08260611	0.989699618	1.068629346
pm2p5_peano_no_weekend	69	model3	5	10	25	lerp	1	5000	504	499	125	4870	2601.937362	683.5959234	0.025	0.975	0.0998	0.1008	0.534278719	0.140368773	279.3415066	43878.68384	44158.02535	13.86225346	0.989286647	1.070720405
pm2p5_peano_no_weekend	69	model3	5	15	25	lerp	1	5000	337	332	118	4867	2947.783743	789.559788	0.0236	0.9764	0.0664	0.0674	0.605667504	0.162227201	197.883867	43892.95565	44090.83951	19.56856224	0.98896498	1.072351974
rad_peano_no_weekend	69	model3	5	3	1	lerp	1	5000	1669	1664	1545	3452	86398.34313	263.7710856	0.309	0.691	0.3328	0.3338	25.02848874	0.076411091	1291.418582	43751.41062	45042.8292	2.998487726	0.99216449	1.049687589
rad_peano_no_weekend	69	model3	5	5	1	lerp	1	5000	1003	998	951	4044	162231.3197	487.4399956	0.1902	0.8098	0.1996	0.2006	40.1165479	0.120534124	783.3314315	43819.76794	44603.09937	4.943377236	0.990616748	1.060036173
rad_peano_no_weekend	69	model3	5	7	1	lerp	1	5000	718	713	692	4304	222540.9123	692.4627255	0.1384	0.8616	0.1426	0.1436	51.70560229	0.16088818	564.3495687	43849.11718	44413.46674	6.86153225	0.989953705	1.064562221
rad_peano_no_weekend	69	model3	5	10	1	lerp	1	5000	504	499	485	4510	303170.3998	1051.818589	0.097	0.903	0.0998	0.1008	67.22181815	0.233219199	395.8676533	43871.40795	44267.2756	9.781811507	0.989450716	1.0680779
rad_peano_no_weekend	69	model3	5	15	1	lerp	1	5000	337	332	328	4657	349199.1426	1142.504283	0.0656	0.9344	0.0664	0.0674	74.9837111	0.245330531	265.8574525	43888.71137	44154.56883	14.56533465	0.989060618	1.070804223
rad_peano_no_weekend	69	model3	5	3	3	lerp	1	5000	1669	1664	1298	3699	87304.65915	269.5448651	0.2596	0.7404	0.3328	0.3338	23.60223281	0.072869658	1211.468698	43756.40269	44967.87139	3.196370466	0.992051296	1.051437333
rad_peano_no_weekend	69	model3	5	5	3	lerp	1	5000	1003	998	833	4162	163537.8288	492.4576348	0.1666	0.8334	0.1996	0.2006	39.29308718	0.118322353	745.13675	43822.15282	44567.28957	5.19676793	0.990562837	1.060887912
rad_peano_no_weekend	69	model3	5	7	3	lerp	1	5000	718	713	634	4362	223014.1892	695.5184772	0.1268	0.8732	0.1426	0.1436	51.12659083	0.159449445	545.5759118	43850.2894	44395.86532	7.097642478	0.989927241	1.064984283
rad_peano_no_weekend	69	model3	5	10	3	lerp	1	5000	504	499	457	4538	303383.0134	1053.165253	0.0914	0.9086	0.0998	0.1008	66.85390334	0.232076962	386.8045086	43871.97385	44258.77836	10.01100732	0.989437953	1.068282961
rad_peano_no_weekend	69	model3	5	15	3	lerp	1	5000	337	332	312	4673	349442.5039	1143.683803	0.0624	0.9376	0.0664	0.0674	74.7790507	0.24474295	260.6785127	43889.03475	44149.71326	14.85470638	0.989053331	1.07092199
rad_peano_no_weekend	69	model3	5	3	5	lerp	1	5000	1669	1664	1060	3937	92187.22395	284.6127739	0.212	0.788	0.3328	0.3338	23.41560172	0.072291789	1134.431968	43761.21287	44895.64483	3.413428815	0.991942251	1.053128849
rad_peano_no_weekend	69	model3	5	5	5	lerp	1	5000	1003	998	732	4263	165087.0504	501.8432485	0.1464	0.8536	0.1996	0.2006	38.72555722	0.117720678	712.4446922	43824.19411	44536.6388	5.43523281	0.990516697	1.061618031
rad_peano_no_weekend	69	model3	5	7	5	lerp	1	5000	718	713	577	4419	223924.8167	701.6129832	0.1154	0.8846	0.1426	0.1436	50.67318775	0.15877189	527.1259385	43851.44142	44378.56736	7.346067578	0.989901235	1.065399394
rad_peano_no_weekend	69	model3	5	10	5	lerp	1	5000	504	499	426	4569	304883.0322	1060.137454	0.0852	0.9148	0.0998	0.1008	66.72861286	0.232028333	376.7703126	43872.60038	44249.3707	10.27762177	0.989423823	1.068510084
rad_peano_no_weekend	69	model3	5	15	5	lerp	1	5000	337	332	296	4689	349795.7193	1145.830794	0.0592	0.9408	0.0664	0.0674	74.59921503	0.244365706	255.4995728	43889.35812	44144.85769	15.15580916	0.989046044	1.071039782
rad_peano_no_weekend	69	model3	5	3	7	lerp	1	5000	1669	1664	862	4135	100293.7412	306.7450441	0.1724	0.8276	0.3328	0.3338	24.25483464	0.074182598	1070.342587	43765.21461	44835.5572	3.617816215	0.991851551	1.05454023
rad_peano_no_weekend	69	model3	5	5	7	lerp	1	5000	1003	998	657	4338	167269.6999	515.2488989	0.1314	0.8686	0.1996	0.2006	38.5591747	0.11877568	688.1684116	43825.70992	44513.87833	5.62696965	0.990482438	1.062160848
rad_peano_no_weekend	69	model3	5	7	7	lerp	1	5000	718	713	517	4479	226060.1878	715.0830654	0.1034	0.8966	0.1426	0.1436	50.47112923	0.159652392	507.7049141	43852.65407	44360.35898	7.627073639	0.989873861	1.065836703
rad_peano_no_weekend	69	model3	5	10	7	lerp	1	5000	504	499	397	4598	305590.5255	1067.036115	0.0794	0.9206	0.0998	0.1008	66.46161929	0.232065271	367.3834841	43873.1865	44240.56998	10.54022005	0.989410605	1.068722641
rad_peano_no_weekend	69	model3	5	15	7	lerp	1	5000	337	332	282	4703	351169.6276	1153.985741	0.0564	0.9436	0.0664	0.0674	74.6692808	0.245372261	250.9680005	43889.64107	44140.60907	15.42946814	0.989039667	1.071142872
rad_peano_no_weekend	69	model3	5	3	10	lerp	1	5000	1669	1664	666	4331	115118.8008	350.5178412	0.1332	0.8668	0.3328	0.3338	26.58018953	0.080932312	1006.900574	43769.17593	44776.07651	3.845764783	0.991761784	1.055941084
rad_peano_no_weekend	69	model3	5	5	10	lerp	1	5000	1003	998	546	4449	172130.4011	546.2162389	0.1092	0.8908	0.1996	0.2006	38.68968333	0.122772812	652.2395164	43827.95332	44480.19284	5.936933702	0.990431739	1.062965238
rad_peano_no_weekend	69	model3	5	7	10	lerp	1	5000	718	713	448	4548	231551.6541	748.1807953	0.0896	0.9104	0.1426	0.1436	50.9128527	0.164507651	485.370736	43854.04862	44339.41935	7.978030976	0.989842384	1.066340053
rad_peano_no_weekend	69	model3	5	10	10	lerp	1	5000	504	499	348	4647	311043.2026	1100.858886	0.0696	0.9304	0.0998	0.1008	66.93419466	0.236896683	351.5229808	43874.17683	44225.69981	11.01578838	0.989388272	1.069081981
rad_peano_no_weekend	69	model3	5	15	10	lerp	1	5000	337	332	263	4722	355013.6735	1177.074225	0.0526	0.9474	0.0664	0.0674	75.18290417	0.249274508	244.8180094	43890.02508	44134.84309	15.81706663	0.989031014	1.071282811
rad_peano_no_weekend	69	model3	5	5	25	lerp	1	5000	1003	998	404	4591	241719.4449	856.2751407	0.0808	0.9192	0.1996	0.2006	52.65071769	0.186511684	606.2764252	43830.82326	44437.09969	6.387025135	0.990366888	1.063996055
rad_peano_no_weekend	69	model3	5	7	25	lerp	1	5000	718	713	121	4875	277198.9638	923.278833	0.0242	0.9758	0.1426	0.1436	56.86132591	0.18939053	379.5261527	43860.65756	44240.18371	10.20299323	0.989693234	1.068731972
rad_peano_no_weekend	69	model3	5	10	25	lerp	1	5000	504	499	86	4909	345624.7089	1209.17194	0.0172	0.9828	0.0998	0.1008	70.40633712	0.246317364	266.7178407	43879.47206	44146.18991	14.51834927	0.989268876	1.071007461
rad_peano_no_weekend	69	model3	5	15	25	lerp	1	5000	337	332	161	4824	394118.3166	1438.066681	0.0322	0.9678	0.0664	0.0674	81.6994852	0.298106692	211.8022678	43892.08658	44103.88885	18.28263128	0.988984562	1.072034689
noise_peano_no_weekend	69	model3	5	3	1	lerp	1	5000	1669	1664	1211	3786	190.5009044	98.34221648	0.2422	0.7578	0.3328	0.3338	0.050317196	0.025975229	1183.308212	43758.16103	44941.46924	3.272438005	0.992011433	1.05205503
noise_peano_no_weekend	69	model3	5	5	1	lerp	1	5000	1003	998	855	4140	322.0780855	170.753862	0.171	0.829	0.1996	0.2006	0.077796639	0.041244894	752.2577923	43821.70818	44573.96597	5.147574151	0.990572888	1.06072901
noise_peano_no_weekend	69	model3	5	7	1	lerp	1	5000	718	713	610	4386	425.5150766	217.7299067	0.122	0.878	0.1426	0.1436	0.097016661	0.049642022	537.807502	43850.77446	44388.58197	7.200165026	0.989916291	1.065159027
noise_peano_no_weekend	69	model3	5	10	1	lerp	1	5000	504	499	443	4552	523.5598787	279.6452437	0.0886	0.9114	0.0998	0.1008	0.115017548	0.061433489	382.2729362	43872.2568	44254.52974	10.12968065	0.989431572	1.06838552
noise_peano_no_weekend	69	model3	5	15	1	lerp	1	5000	337	332	300	4685	642.3998971	345.9416827	0.06	0.94	0.0664	0.0674	0.137118441	0.073840274	256.7943078	43889.27728	44146.07158	15.07939487	0.989047866	1.071010332
noise_peano_no_weekend	69	model3	5	3	3	lerp	1	5000	1669	1664	694	4303	235.196593	122.9812642	0.1388	0.8612	0.3328	0.3338	0.054658748	0.028580354	1015.963718	43768.61003	44784.57375	3.811457728	0.991774607	1.055740734
noise_peano_no_weekend	69	model3	5	5	3	lerp	1	5000	1003	998	618	4377	355.805462	188.9414888	0.1236	0.8764	0.1996	0.2006	0.081289802	0.043166893	675.5447458	43826.49814	44502.04289	5.732118843	0.990464624	1.062443333
noise_peano_no_weekend	69	model3	5	7	3	lerp	1	5000	718	713	461	4535	455.8903678	234.5146194	0.0922	0.9078	0.1426	0.1436	0.100527093	0.051712154	489.5786246	43853.78588	44343.3645	7.909460446	0.989848314	1.066245183
noise_peano_no_weekend	69	model3	5	10	3	lerp	1	5000	504	499	360	4635	536.9911613	286.4022015	0.072	0.928	0.0998	0.1008	0.115855698	0.061791198	355.4071857	43873.9343	44229.34148	10.89539807	0.989393742	1.068993957
noise_peano_no_weekend	69	model3	5	15	3	lerp	1	5000	337	332	258	4727	654.5471763	351.7765179	0.0516	0.9484	0.0664	0.0674	0.138469891	0.074418557	243.1995907	43890.12613	44133.32572	15.92232436	0.989028737	1.071319643
noise_peano_no_weekend	69	model3	5	3	5	lerp	1	5000	1669	1664	508	4489	293.215714	154.1121568	0.1016	0.8984	0.3328	0.3338	0.065318716	0.034331066	955.7585426	43772.36924	44728.12779	4.051549208	0.991689432	1.057073057
noise_peano_no_weekend	69	model3	5	5	5	lerp	1	5000	1003	998	476	4519	405.9312057	217.4832051	0.0952	0.9048	0.1996	0.2006	0.089827662	0.048126401	629.5816545	43829.36808	44458.94973	6.150596572	0.990399769	1.063473138
noise_peano_no_weekend	69	model3	5	7	5	lerp	1	5000	718	713	368	4628	514.9898113	265.6290545	0.0736	0.9264	0.1426	0.1436	0.111276969	0.057396079	459.4760367	43855.66548	44315.14152	8.427649012	0.98980589	1.066924242
noise_peano_no_weekend	69	model3	5	10	5	lerp	1	5000	504	499	289	4706	574.7678997	305.6863311	0.0578	0.9422	0.0998	0.1008	0.122135125	0.064956721	332.4256401	43875.36927	44207.79491	11.64862844	0.989361383	1.069514978
noise_peano_no_weekend	69	model3	5	15	5	lerp	1	5000	337	332	211	4774	698.4430887	374.2701591	0.0422	0.9578	0.0664	0.0674	0.146301443	0.078397604	227.9864549	43891.07604	44119.0625	16.98479311	0.989007332	1.07166599
noise_peano_no_weekend	69	model3	5	3	7	lerp	1	5000	1669	1664	407	4590	374.0068505	196.7488704	0.0814	0.9186	0.3328	0.3338	0.081482974	0.042864678	923.0664848	43774.41054	44697.47702	4.195042102	0.991643188	1.057797932
noise_peano_no_weekend	69	model3	5	5	7	lerp	1	5000	1003	998	379	4616	472.1412788	254.4650069	0.0758	0.9242	0.1996	0.2006	0.102283639	0.055126735	598.1843317	43831.32853	44429.51286	6.473427272	0.990355471	1.064177744
noise_peano_no_weekend	69	model3	5	7	7	lerp	1	5000	718	713	301	4695	594.8680154	307.014902	0.0602	0.9398	0.1426	0.1436	0.126702453	0.065391885	437.789226	43857.01961	44294.80883	8.845130341	0.989775329	1.067413993
noise_peano_no_weekend	69	model3	5	10	7	lerp	1	5000	504	499	243	4752	624.4088962	333.7088954	0.0486	0.9514	0.0998	0.1008	0.131399178	0.070224936	317.536188	43876.29897	44193.83515	12.19483924	0.989340419	1.069852811
noise_peano_no_weekend	69	model3	5	15	7	lerp	1	5000	337	332	178	4807	737.9121094	397.1530638	0.0356	0.9644	0.0664	0.0674	0.153507824	0.082619735	217.3048914	43891.743	44109.04789	17.81967604	0.988992304	1.071909303
noise_peano_no_weekend	69	model3	5	3	10	lerp	1	5000	1669	1664	287	4710	516.9215305	272.4854179	0.0574	0.9426	0.3328	0.3338	0.109749794	0.05785253	884.2244359	43776.83584	44661.06027	4.379321142	0.991588249	1.058660464
noise_peano_no_weekend	69	model3	5	5	10	lerp	1	5000	1003	998	288	4707	580.9771928	315.6193581	0.0576	0.9424	0.1996	0.2006	0.123428339	0.067053188	568.7291113	43833.16772	44401.89683	6.808694491	0.990313917	1.064839616
noise_peano_no_weekend	69	model3	5	7	10	lerp	1	5000	718	713	227	4769	735.8795465	381.867828	0.0454	0.9546	0.1426	0.1436	0.154304791	0.080072935	413.8366292	43858.51521	44272.35184	9.357080773	0.989741577	1.067955435
noise_peano_no_weekend	69	model3	5	10	10	lerp	1	5000	504	499	198	4797	732.7240315	392.366262	0.0396	0.9604	0.0998	0.1008	0.152746306	0.081794093	302.9704197	43877.20845	44180.17887	12.78112487	0.989319912	1.070183507
noise_peano_no_weekend	69	model3	5	15	10	lerp	1	5000	337	332	138	4847	835.0229575	450.8505381	0.0276	0.9724	0.0664	0.0674	0.172276245	0.09301641	204.3575418	43892.55143	44096.90897	18.94866582	0.988974088	1.072204376
noise_peano_no_weekend	69	model3	5	3	25	lerp	1	5000	1669	1664	94	4903	1176.984127	630.3113796	0.0188	0.9812	0.3328	0.3338	0.240053871	0.128556268	821.7534739	43780.73652	44602.49	4.712243866	0.991499903	1.060050656
noise_peano_no_weekend	69	model3	5	5	25	lerp	1	5000	1003	998	122	4873	1032.381087	573.3824127	0.0244	0.9756	0.1996	0.2006	0.211857395	0.117665178	514.9976103	43836.52271	44351.52032	7.519069388	0.990238124	1.06604911
noise_peano_no_weekend	69	model3	5	7	25	lerp	1	5000	718	713	79	4917	1405.017726	742.3904748	0.0158	0.9842	0.1426	0.1436	0.285746945	0.150984437	365.9314356	43861.50641	44227.43785	10.58204459	0.98967408	1.069039969
noise_peano_no_weekend	69	model3	5	10	25	lerp	1	5000	504	499	67	4928	1531.31571	798.8096492	0.0134	0.9866	0.0998	0.1008	0.310737766	0.162096114	260.5678496	43879.85607	44140.42392	14.86101517	0.989260219	1.071147365
noise_peano_no_weekend	69	model3	5	15	25	lerp	1	5000	337	332	50	4935	1204.260864	675.7812288	0.01	0.99	0.0664	0.0674	0.244024491	0.136936419	175.8733726	43894.32998	44070.20336	22.01756133	0.988934016	1.07285411
    """,
    header=0,
)
data["error"] *= 0.01

# ### SR vs. error

# +
d = data[["dataset", "time steps", "error", "Suppression Rate"]]
d = d.drop(d[d["error"] == 0.25].index)
d = d.drop(d[d["time steps"] == 15].index)
d = np.array(np.split(d.values, 4))
co2 = np.array(np.split(d[0], 5))
pm = np.array(np.split(d[1], 5))
rad = np.array(np.split(d[2], 5))
noise = np.array(np.split(d[3], 5))

os.makedirs(os.path.join(PLOTS_DIR, "dlds_SR_error"), exist_ok=True)

plot(
    xs=co2[:, :, 1],
    ys=co2[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlds_SR_error", "co2_SR_error_dlds_lerp.pdf"),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$ts$",
    ylabel="$SR$",
    grid=True,
    label_size=22,
    tick_size=20,
    ylim=(0.65, 1),
    legend_pos="lower right",
)
plot(
    xs=noise[:, :, 1],
    ys=noise[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlds_SR_error", "noise_SR_error_dlds_lerp.pdf"),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$ts$",
    ylabel="$SR$",
    grid=True,
    label_size=22,
    tick_size=20,
    ylim=(0.65, 1),
)
plot(
    xs=pm[:, :, 1],
    ys=pm[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlds_SR_error", "pm_SR_error_dlds_lerp.pdf"),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$ts$",
    ylabel="$SR$",
    grid=True,
    label_size=22,
    tick_size=20,
    ylim=(0.65, 1),
)
plot(
    xs=rad[:, :, 1],
    ys=rad[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlds_SR_error", "rad_SR_error_dlds_lerp.pdf"),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$ts$",
    ylabel="$SR$",
    grid=True,
    label_size=22,
    tick_size=20,
    ylim=(0.65, 1),
)
# -

# ### MAPE vs. error

# +
d = data[["dataset", "time steps", "error", "MAPE"]]
d = d.drop(d[d["error"] == 0.25].index)
d = d.drop(d[d["time steps"] == 15].index)
d = np.array(np.split(d.values, 4))
co2 = np.array(np.split(d[0], 5))
pm = np.array(np.split(d[1], 5))
rad = np.array(np.split(d[2], 5))
noise = np.array(np.split(d[3], 5))

os.makedirs(os.path.join(PLOTS_DIR, "dlds_MAPE_error"), exist_ok=True)

plot(
    xs=co2[:, :, 1],
    ys=co2[:, :, 3],
    save_path=os.path.join(
        PLOTS_DIR, "dlds_MAPE_error", "co2_MAPE_error_dlds_lerp.pdf"
    ),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$ts$",
    ylabel="$MAPE$",
    grid=True,
    label_size=22,
    tick_size=20,
    ylim=(0, 0.12),
)
plot(
    xs=noise[:, :, 1],
    ys=noise[:, :, 3],
    save_path=os.path.join(
        PLOTS_DIR, "dlds_MAPE_error", "noise_MAPE_error_dlds_lerp.pdf"
    ),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$ts$",
    ylabel="$MAPE$",
    grid=True,
    label_size=22,
    tick_size=20,
    ylim=(0, 0.12),
)
plot(
    xs=pm[:, :, 1],
    ys=pm[:, :, 3],
    save_path=os.path.join(PLOTS_DIR, "dlds_MAPE_error", "pm_MAPE_error_dlds_lerp.pdf"),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$ts$",
    ylabel="$MAPE$",
    grid=True,
    label_size=22,
    tick_size=20,
    ylim=(0, 0.12),
)
plot(
    xs=rad[:, :, 1],
    ys=rad[:, :, 3],
    save_path=os.path.join(
        PLOTS_DIR, "dlds_MAPE_error", "rad_MAPE_error_dlds_lerp.pdf"
    ),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$ts$",
    ylabel="$MAPE$",
    grid=True,
    label_size=22,
    tick_size=20,
    ylim=(0, 0.25),
)
# -

# ## Pareto Energy vs. MAPE

# +
d = data[["dataset", "MAPE", "error", "Active Energy [J]", "time steps"]]
d = d.drop(d[d["error"] == 0.25].index)
d = d.drop(d[d["time steps"] == 15].index)
d = np.array(np.split(d.values, 4))
co2 = np.array(np.split(d[0], 5))
pm = np.array(np.split(d[1], 5))
rad = np.array(np.split(d[2], 5))
noise = np.array(np.split(d[3], 5))

os.makedirs(os.path.join(PLOTS_DIR, "dlds_pareto_energy_MAPE"), exist_ok=True)

plot(
    xs=co2[:, :, 1],
    ys=co2[:, :, 3],
    save_path=os.path.join(
        PLOTS_DIR, "dlds_pareto_energy_MAPE", "co2_pareto_energy_MAPE_dlds_lerp.pdf"
    ),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$MAPE$",
    ylabel="$Active~Energy~[J]$",
    fmts=["o", "x", "s", "^", "h"],
    grid=True,
    label_size=22,
    tick_size=20,
    marker_size=[10, 8, 8, 8, 10],
    marker_line_width=[1.5, 1.5, 1.5, 1.5, 1.5],
    filled=False,
)
plot(
    xs=noise[:, :, 1],
    ys=noise[:, :, 3],
    save_path=os.path.join(
        PLOTS_DIR, "dlds_pareto_energy_MAPE", "noise_pareto_energy_MAPE_dlds_lerp.pdf"
    ),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$MAPE$",
    ylabel="$Active~Energy~[J]$",
    fmts=["o", "x", "s", "^", "h"],
    grid=True,
    label_size=22,
    tick_size=20,
    marker_size=[10, 8, 8, 8, 10],
    marker_line_width=[1.5, 1.5, 1.5, 1.5, 1.5],
    filled=False,
)
plot(
    xs=pm[:, :, 1],
    ys=pm[:, :, 3],
    save_path=os.path.join(
        PLOTS_DIR, "dlds_pareto_energy_MAPE", "pm_pareto_energy_MAPE_dlds_lerp.pdf"
    ),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$MAPE$",
    ylabel="$Active~Energy~[J]$",
    fmts=["o", "x", "s", "^", "h"],
    grid=True,
    label_size=22,
    tick_size=20,
    marker_size=[10, 8, 8, 8, 10],
    marker_line_width=[1.5, 1.5, 1.5, 1.5, 1.5],
    filled=False,
)
plot(
    xs=rad[:, :, 1],
    ys=rad[:, :, 3],
    save_path=os.path.join(
        PLOTS_DIR, "dlds_pareto_energy_MAPE", "rad_pareto_energy_MAPE_dlds_lerp.pdf"
    ),
    labels=[
        "$\delta=0.01$",
        "$\delta=0.03$",
        "$\delta=0.05$",
        "$\delta=0.07$",
        "$\delta=0.10$",
    ],
    xlabel="$MAPE$",
    ylabel="$Active~Energy~[J]$",
    fmts=["o", "x", "s", "^", "h"],
    grid=True,
    label_size=22,
    tick_size=20,
    marker_size=[10, 8, 8, 8, 10],
    marker_line_width=[1.5, 1.5, 1.5, 1.5, 1.5],
    filled=False,
)
# -


